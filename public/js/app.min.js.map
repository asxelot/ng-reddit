{"version":3,"sources":["directives.js","app.js","controllers.js","factories.js","filters.js"],"names":["inputDirective","restrict","require","link","scope","el","attrs","ngModel","$options","angular","extend","allowInvalid","updateOnDefault","$watch","val","module","config","$routeProvider","$locationProvider","when","templateUrl","controller","reloadOnSearch","resolve","subreddit","$route","_posts","get","page","current","params","$promise","_subreddit","comments","post","results","_search","query","html5Mode","$httpProvider","interceptors","push","$q","$rootScope","onError","err","console","error","errors","data","reject","requestError","responseError","$scope","$http","$location","$routeParams","$anchorScroll","_remove","search","history","success","user","logout","posts","_id","path","vote","n","url","put","username","indexOf","isVoted","changePage","window","encodeURIComponent","$on","$$path","subreddits","_setDirty","newSubreddit","submit","newSubredditForm","$invalid","name","newComment","expandText","addComment","newCommentForm","save","comment","$setPristine","deleteComment","newPost","type","newPostForm","_afterLogin","newUser","signup","signupForm","loggedUser","login","loginForm","directive","subredditExist","subr","$asyncValidators","subredditAvailable","checkUsername","invalidUsername","test","$validators","emailExist","email","password","matchPassword","confirmPassword","$validate","on","style","height","scrollHeight","factory","$resource","a","e","i","splice","length","form","k","$setDirty","filter","s","parseInt","last","slice","replace","m","split","date","moment","fromNow","$sce","text","trustAsHtml","markdown","toHTML","document","createElement","href","hostname"],"mappings":"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","file":"app.min.js","sourcesContent":["angular\r\n  .module('ngReddit')\r\n\r\n  .directive('subredditExist', function($q, $http) {\r\n    function subredditExist(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/r/' + val)\r\n          .success(function(subr) {\r\n            subr ? resolve() : reject()\r\n          })\r\n      })\r\n    }\r\n    \r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.subredditExist = subredditExist\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('subredditAvailable', function($q, $http) {\r\n    function subredditAvailable(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/r/' + val)\r\n          .success(function(subr) {\r\n            subr ? reject() : resolve()\r\n          })\r\n      })\r\n    }\r\n    \r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.subredditAvailable = subredditAvailable\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('usernameValidator', function($q, $http) {\r\n    function checkUsername(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/u/' + val)\r\n          .success(function(user) {\r\n            user ? reject() : resolve()\r\n          })\r\n      })\r\n    }\r\n\r\n    function invalidUsername(username) {\r\n      return /^[a-zA-Z][a-zA-Z0-9]+$/.test(username)\r\n    }\r\n\r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.checkUsername = checkUsername\r\n        ngModel.$validators.invalidUsername = invalidUsername\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('emailExist', function($q, $http) {\r\n    function emailExist(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/email/' + val)\r\n          .success(function(email) {\r\n            email ? reject() : resolve()\r\n          })\r\n      })\r\n    }\r\n\r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.emailExist = emailExist\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('matchTo', function() {\r\n    return {\r\n      restrict: 'A',\r\n      scope: {\r\n        password: '=matchTo'\r\n      },\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$validators.matchPassword = function(confirmPassword) {\r\n          return scope.password == confirmPassword\r\n        }\r\n\r\n        scope.$watch('password', ngModel.$validate)\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('elasticTextarea', function() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, el) {\r\n        el.on('input', function() {\r\n          el[0].style.height = el[0].scrollHeight + 'px'\r\n        })\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('input', inputDirective)\r\n\r\n  .directive('textarea', inputDirective)\r\n\r\n\r\nfunction inputDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    require: 'ngModel',\r\n    link: function(scope, el, attrs, ngModel) {\r\n      ngModel.$options = ngModel.$options || {}\r\n      angular.extend(\r\n        ngModel.$options, \r\n        {allowInvalid: true, updateOnDefault: true}\r\n      )\r\n\r\n      scope.$watch(attrs.ngModel, function(val) {\r\n        el[val?'addClass':'removeClass']('ng-not-empty')\r\n      })\r\n    }\r\n  }  \r\n}","angular.module('ngReddit', [\r\n    'ngMessages',\r\n    'ngResource',\r\n    'ngRoute'\r\n  ])\r\n\r\n  .config(function($routeProvider, $locationProvider) {\r\n    $routeProvider\r\n      .when('/', {\r\n        templateUrl: 'views/home.html',\r\n        controller: 'homeCtrl',\r\n        reloadOnSearch: true, \r\n        resolve: {\r\n          subreddit: function($route, _posts) {\r\n            return _posts.get({\r\n              page: $route.current.params.page || 1\r\n            }).$promise\r\n          }\r\n        }\r\n      })\r\n      .when('/r/:subreddit', {\r\n        templateUrl: 'views/home.html',\r\n        controller: 'subredditCtrl',\r\n        resolve: {\r\n          subreddit: function($route, _subreddit) {\r\n            return _subreddit.get({\r\n              subreddit: $route.current.params.subreddit,\r\n              page: $route.current.params.page || 1\r\n            }).$promise\r\n          }\r\n        }\r\n      })\r\n      .when('/r/:subreddit/comments/:post', {\r\n        templateUrl: 'views/post.html',\r\n        controller: 'postCtrl',\r\n        resolve: {\r\n          subreddit: function($route, _subreddit) {\r\n            return _subreddit.get({\r\n              subreddit: $route.current.params.subreddit,\r\n              comments: 'comments',\r\n              post: $route.current.params.post\r\n            }).$promise\r\n          }\r\n        }\r\n      })\r\n      .when('/subreddits', {\r\n        templateUrl: 'views/subreddits.html',\r\n        controller: 'subredditsCtrl'\r\n      })\r\n      .when('/subreddits/create', {\r\n        templateUrl: 'views/newSubreddit.html',\r\n        controller: 'newSubredditCtrl'\r\n      })\r\n      .when('/submit/:type', {\r\n        templateUrl: 'views/submit.html',\r\n        controller: 'submitCtrl'\r\n      })\r\n      .when('/search/:query', {\r\n        templateUrl: 'views/_posts.html',\r\n        controller: 'searchCtrl',\r\n        resolve: {\r\n          results: function($route, _search) {\r\n            return _search.query({\r\n              query: $route.current.params.query\r\n            })\r\n          }\r\n        }\r\n      })      \r\n      .when('/signup', {\r\n        templateUrl: 'views/signup.html',\r\n        controller: 'signupCtrl'\r\n      })\r\n      .when('/login', {\r\n        templateUrl: 'views/login.html',\r\n        controller: 'loginCtrl'\r\n      })\r\n\r\n\r\n    $locationProvider.html5Mode(true)\r\n  })\r\n\r\n  .config(function($httpProvider) {\r\n    $httpProvider.interceptors.push(function($q, $rootScope) {\r\n      function onError(err) {\r\n        console.error(err)\r\n        $rootScope.errors.push(err.data)\r\n        return $q.reject(err)\r\n      }\r\n\r\n      return {\r\n        requestError: onError,\r\n        responseError: onError\r\n      }\r\n    })\r\n  })","angular\r\n  .module('ngReddit')\r\n\r\n  .controller('mainCtrl', function($rootScope, $scope, $http, $location,\r\n                          $routeParams, $anchorScroll, _subreddit, _remove) {\r\n    $scope.page = +$location.search().page || 1\r\n    $rootScope.errors = []\r\n    $rootScope.history = []\r\n\r\n    $http.get('/api/check/auth').success(function(user) {\r\n      $rootScope.user = user\r\n    })\r\n\r\n    $scope.logout = function() {\r\n      $http.get('/api/logout').success(function() {\r\n        $rootScope.user = null\r\n      })\r\n    } \r\n\r\n    $scope.delete = function(posts, post) {\r\n      return _subreddit.delete({\r\n        subreddit: post.subreddit,\r\n        comments: 'comments',\r\n        post: post._id\r\n      }, function() {\r\n        _remove(posts, post)\r\n        if (~$location.path().search('comments')) \r\n          $location.path('/')\r\n      })\r\n    }\r\n\r\n    $scope.vote = function(n, post) {\r\n      if (!$rootScope.user) return false\r\n\r\n      var url = '/api/' + \r\n                (post.comments ? 'posts/' : 'comments/') +\r\n                post._id + '/vote/' + n\r\n\r\n      $http.put(url).success(function() {\r\n        var vote = n > 0 ? 'upvotes' : 'downvotes',\r\n            username = $rootScope.user.username\r\n\r\n        if (~post[vote].indexOf(username))\r\n          _remove(post[vote], username)\r\n        else\r\n          post[vote].push(username)\r\n        \r\n        _remove(post[n < 0 ? 'upvotes' : 'downvotes'], username)\r\n      })\r\n    }\r\n\r\n    $scope.isVoted = function(n, post) {\r\n      if (!$rootScope.user) return false\r\n\r\n      var vote = n > 0 ? 'upvotes' : 'downvotes' \r\n\r\n      return ~post[vote].indexOf($rootScope.user.username)\r\n    } \r\n\r\n    $scope.changePage = function(n) { \r\n      $location.search('page', $scope.page += n)\r\n      $anchorScroll(0)\r\n    }\r\n\r\n    $scope.search = function() {    \r\n      $location.path('/search/' + window.encodeURIComponent($scope.query))\r\n      $scope.query = ''\r\n    }\r\n\r\n    $rootScope.$on('$routeChangeSuccess', function() {\r\n      $rootScope.history.push($location.$$path)\r\n    })\r\n  })\r\n\r\n  .controller('homeCtrl', function($scope, $rootScope, $routeParams, \r\n                          subreddit) {\r\n    $rootScope.subreddit = subreddit\r\n  })\r\n\r\n  .controller('subredditCtrl', function($rootScope, $scope, $routeParams, \r\n                                subreddit) {\r\n    $rootScope.subreddit = subreddit\r\n  })\r\n\r\n  .controller('subredditsCtrl', function($scope, $http) {\r\n    $http\r\n      .get('/api/r')\r\n      .success(function(subreddits) {\r\n        $scope.subreddits = subreddits\r\n      })\r\n  })\r\n\r\n  .controller('newSubredditCtrl', function($scope, $http, $location, \r\n                                  _setDirty) {\r\n    $scope.newSubreddit = {}\r\n\r\n    $scope.submit = function() {\r\n      if ($scope.newSubredditForm.$invalid)\r\n        return _setDirty($scope.newSubredditForm)\r\n\r\n      $http\r\n        .post('/api/r', $scope.newSubreddit)\r\n        .success(function(subreddit) {\r\n          $location.path('/r/' + subreddit.name)\r\n        })\r\n    }\r\n  })\r\n\r\n  .controller('postCtrl', function($rootScope, $scope, $http,\r\n                          subreddit, _subreddit, _setDirty, _remove) {\r\n    $scope.newComment = {}\r\n    $scope.expandText = true\r\n    $rootScope.subreddit = subreddit\r\n\r\n    $scope.addComment = function() {\r\n      if ($scope.newCommentForm.$invalid)\r\n        return _setDirty($scope.newCommentForm)\r\n\r\n      _subreddit.save({\r\n        subreddit: $scope.subreddit.name,\r\n        comments: 'comments',\r\n        post: $scope.subreddit.posts[0]._id\r\n      }, $scope.newComment, function(comment) {\r\n        $scope.subreddit.posts[0].comments.push(comment)\r\n        $scope.newComment = {}\r\n        $scope.newCommentForm.comment.$setPristine()\r\n      })\r\n    }\r\n\r\n    $scope.deleteComment = function(comment) {\r\n      $http\r\n        .delete('/api/comments/' + comment._id)\r\n        .success(function() {\r\n          _remove($scope.subreddit.posts[0].comments, comment)\r\n        })\r\n\r\n      return false\r\n    }\r\n  })\r\n\r\n  .controller('submitCtrl', function($scope, $routeParams, $location, \r\n                            _subreddit, _setDirty) {\r\n    $scope.newPost = {}\r\n    $scope.type = $routeParams.type\r\n    \r\n    if ($scope.subreddit) \r\n      $scope.newPost.subreddit = $scope.subreddit.name\r\n\r\n    $scope.submit = function() {\r\n      if ($scope.newPostForm.$invalid)\r\n        return _setDirty($scope.newPostForm)\r\n\r\n      _subreddit.save({ \r\n        subreddit: $scope.newPost.subreddit \r\n      }, $scope.newPost, function(post) {\r\n        $location.path('/r/' + post.subreddit + '/comments/' + post._id)\r\n      })\r\n    }\r\n  })\r\n\r\n  .controller('searchCtrl', function($scope, results) {\r\n    $scope.subreddit = {\r\n      posts: results\r\n    }\r\n  })\r\n\r\n  .controller('signupCtrl', function($rootScope, $scope, $http, $location,\r\n                            _afterLogin, _setDirty) {\r\n    if ($rootScope.user) return $location.path('/')\r\n    $scope.newUser = {}\r\n\r\n    $scope.signup = function() {\r\n      if ($scope.signupForm.$invalid) \r\n        return _setDirty($scope.signupForm)\r\n\r\n      $http\r\n        .post('/api/signup', $scope.newUser)\r\n        .success(_afterLogin)\r\n    }\r\n  })\r\n\r\n  .controller('loginCtrl', function($rootScope, $scope, $http, $location,\r\n                           _afterLogin, _setDirty) {\r\n    if ($rootScope.user) return $location.path('/')\r\n    $scope.loggedUser = {}\r\n\r\n    $scope.login = function() {\r\n      if ($scope.loginForm.$invalid)\r\n        return _setDirty($scope.loginForm)\r\n\r\n      $http\r\n        .post('/api/login', $scope.loggedUser)\r\n        .success(_afterLogin)\r\n    }\r\n  })","angular\r\n  .module('ngReddit')\r\n\r\n  .factory('_subreddit', function($resource) {\r\n    return $resource('/api/r/:subreddit/:comments/:post')\r\n  })\r\n\r\n  .factory('_posts', function($resource) {\r\n    return $resource('/api/posts/')\r\n  })\r\n\r\n  .factory('_search', function($resource) {\r\n    return $resource('/api/search/:query')\r\n  })\r\n\r\n  .factory('_authUser', function($resource) {\r\n    return $resource('/api/authcheck')\r\n  })\r\n\r\n  .factory('_remove', function() {\r\n    return function(a, e) {\r\n      var i = a.indexOf(e)\r\n      if (i > -1) return a.splice(i, 1)\r\n    }\r\n  })\r\n\r\n  .factory('_afterLogin', function($http, $rootScope, $location) {\r\n    return function(user) {\r\n      $rootScope.user = user\r\n      $location.path($rootScope.history[$rootScope.history.length-2] || '/')\r\n    }\r\n  })\r\n\r\n  .factory('_setDirty', function() {\r\n    return function(form) {\r\n      for (var k in form) \r\n        if (/^[^$]/.test(k)) form[k].$setDirty()      \r\n    }\r\n  })","angular\r\n  .module('ngReddit')\r\n\r\n  .filter('pluralize', function() {\r\n    // {{post.comments.length + ' комментари(й,я,ев)' | pluralize}}\r\n\r\n    return function(s) {\r\n      var n = '' + parseInt(s),\r\n          last = n.slice(-1)\r\n\r\n      return s.replace(/\\(([^)]+)\\)/, function(m) {\r\n        m = m.slice(1, -1).split(',')\r\n\r\n        if (n.slice(-2, -1) == 1 || last > 4 || last === '0')\r\n          return m[2]\r\n        else if (last == 1)\r\n          return m[0]\r\n        else\r\n          return m[1]\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('fromNow', function() {\r\n    return function(date) {\r\n      return moment(date).fromNow()\r\n    }\r\n  })\r\n\r\n  .filter('md', function($sce) { \r\n    return function(text) {\r\n      return $sce.trustAsHtml(markdown.toHTML(text || ''))\r\n    }\r\n  })\r\n\r\n  .filter('hostname', function() {\r\n    return function(link) {\r\n      if (!link) return 'self'\r\n      var a = document.createElement('a')\r\n      a.href = link\r\n      return a.hostname\r\n    }\r\n  })"],"sourceRoot":"/source/"}