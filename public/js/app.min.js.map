{"version":3,"sources":["directives.js","app.js","controllers.js","factories.js","filters.js"],"names":["inputDirective","restrict","require","link","scope","el","attrs","ngModel","$options","angular","extend","allowInvalid","updateOnDefault","$watch","val","module","config","$routeProvider","$locationProvider","when","templateUrl","controller","reloadOnSearch","resolve","subreddit","$route","_posts","get","page","current","params","$promise","_subreddit","comments","post","html5Mode","$httpProvider","interceptors","push","$q","$rootScope","onError","err","console","error","errors","data","reject","requestError","responseError","$scope","$http","$location","$routeParams","$anchorScroll","_remove","search","history","success","user","logout","posts","_id","path","vote","n","url","put","username","indexOf","isVoted","changePage","$on","$$path","subreddits","_setDirty","newSubreddit","submit","newSubredditForm","$invalid","name","newComment","expandText","addComment","newCommentForm","save","comment","$setPristine","deleteComment","newPost","type","newPostForm","_afterLogin","newUser","signup","signupForm","loggedUser","login","loginForm","directive","subredditExist","subr","$asyncValidators","subredditAvailable","checkUsername","invalidUsername","test","$validators","emailExist","email","password","matchPassword","confirmPassword","$validate","on","style","height","scrollHeight","factory","$resource","a","e","i","splice","length","form","k","$setDirty","filter","s","parseInt","last","slice","replace","m","split","date","moment","fromNow","$sce","text","trustAsHtml","markdown","toHTML","document","createElement","href","hostname"],"mappings":"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","file":"app.min.js","sourcesContent":["angular\r\n  .module('ngReddit')\r\n\r\n  .directive('subredditExist', function($q, $http) {\r\n    function subredditExist(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/r/' + val)\r\n          .success(function(subr) {\r\n            subr ? resolve() : reject()\r\n          })\r\n      })\r\n    }\r\n    \r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.subredditExist = subredditExist\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('subredditAvailable', function($q, $http) {\r\n    function subredditAvailable(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/r/' + val)\r\n          .success(function(subr) {\r\n            subr ? reject() : resolve()\r\n          })\r\n      })\r\n    }\r\n    \r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.subredditAvailable = subredditAvailable\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('usernameValidator', function($q, $http) {\r\n    function checkUsername(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/u/' + val)\r\n          .success(function(user) {\r\n            user ? reject() : resolve()\r\n          })\r\n      })\r\n    }\r\n\r\n    function invalidUsername(username) {\r\n      return /^[a-zA-Z][a-zA-Z0-9]+$/.test(username)\r\n    }\r\n\r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.checkUsername = checkUsername\r\n        ngModel.$validators.invalidUsername = invalidUsername\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('emailExist', function($q, $http) {\r\n    function emailExist(val) {\r\n      return $q(function(resolve, reject) {\r\n        $http\r\n          .get('/api/check/email/' + val)\r\n          .success(function(email) {\r\n            email ? reject() : resolve()\r\n          })\r\n      })\r\n    }\r\n\r\n    return {\r\n      restrict: 'A',\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$asyncValidators.emailExist = emailExist\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('matchTo', function() {\r\n    return {\r\n      restrict: 'A',\r\n      scope: {\r\n        password: '=matchTo'\r\n      },\r\n      require: 'ngModel',\r\n      link: function(scope, el, attrs, ngModel) {\r\n        ngModel.$validators.matchPassword = function(confirmPassword) {\r\n          return scope.password == confirmPassword\r\n        }\r\n\r\n        scope.$watch('password', ngModel.$validate)\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('elasticTextarea', function() {\r\n    return {\r\n      restrict: 'A',\r\n      link: function(scope, el) {\r\n        el.on('input', function() {\r\n          el[0].style.height = el[0].scrollHeight + 'px'\r\n        })\r\n      }\r\n    }\r\n  })\r\n\r\n  .directive('input', inputDirective)\r\n\r\n  .directive('textarea', inputDirective)\r\n\r\n\r\nfunction inputDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    require: 'ngModel',\r\n    link: function(scope, el, attrs, ngModel) {\r\n      ngModel.$options = ngModel.$options || {}\r\n      angular.extend(\r\n        ngModel.$options, \r\n        {allowInvalid: true, updateOnDefault: true}\r\n      )\r\n\r\n      scope.$watch(attrs.ngModel, function(val) {\r\n        el[val?'addClass':'removeClass']('ng-not-empty')\r\n      })\r\n    }\r\n  }  \r\n}","angular.module('ngReddit', [\r\n    'ngMessages',\r\n    'ngResource',\r\n    'ngRoute'\r\n  ])\r\n\r\n  .config(function($routeProvider, $locationProvider) {\r\n    $routeProvider\r\n      .when('/', {\r\n        templateUrl: 'views/home.html',\r\n        controller: 'homeCtrl',\r\n        reloadOnSearch: true, \r\n        resolve: {\r\n          subreddit: function($route, _posts) {\r\n            return _posts.get({\r\n              page: $route.current.params.page || 1\r\n            }).$promise\r\n          }\r\n        }\r\n      })\r\n      .when('/r/:subreddit', {\r\n        templateUrl: 'views/home.html',\r\n        controller: 'subredditCtrl',\r\n        resolve: {\r\n          subreddit: function($route, _subreddit) {\r\n            return _subreddit.get({\r\n              subreddit: $route.current.params.subreddit,\r\n              page: $route.current.params.page || 1\r\n            }).$promise\r\n          }\r\n        }\r\n      })\r\n      .when('/r/:subreddit/comments/:post', {\r\n        templateUrl: 'views/post.html',\r\n        controller: 'postCtrl',\r\n        resolve: {\r\n          subreddit: function($route, _subreddit) {\r\n            return _subreddit.get({\r\n              subreddit: $route.current.params.subreddit,\r\n              comments: 'comments',\r\n              post: $route.current.params.post\r\n            }).$promise\r\n          }\r\n        }\r\n      })\r\n      .when('/subreddits', {\r\n        templateUrl: 'views/subreddits.html',\r\n        controller: 'subredditsCtrl'\r\n      })\r\n      .when('/subreddits/create', {\r\n        templateUrl: 'views/newSubreddit.html',\r\n        controller: 'newSubredditCtrl'\r\n      })\r\n      .when('/submit/:type', {\r\n        templateUrl: 'views/submit.html',\r\n        controller: 'submitCtrl'\r\n      })\r\n      .when('/signup', {\r\n        templateUrl: 'views/signup.html',\r\n        controller: 'signupCtrl'\r\n      })\r\n      .when('/login', {\r\n        templateUrl: 'views/login.html',\r\n        controller: 'loginCtrl'\r\n      })\r\n\r\n\r\n    $locationProvider.html5Mode(true)\r\n  })\r\n\r\n  .config(function($httpProvider) {\r\n    $httpProvider.interceptors.push(function($q, $rootScope) {\r\n      function onError(err) {\r\n        console.error(err)\r\n        $rootScope.errors.push(err.data)\r\n        return $q.reject(err)\r\n      }\r\n\r\n      return {\r\n        requestError: onError,\r\n        responseError: onError\r\n      }\r\n    })\r\n  })","angular\r\n  .module('ngReddit')\r\n\r\n  .controller('mainCtrl', function($rootScope, $scope, $http, $location,\r\n                          $routeParams, $anchorScroll, _subreddit, _remove) {\r\n    $scope.page = +$location.search().page || 1\r\n    $rootScope.errors = []\r\n    $rootScope.history = []\r\n\r\n    $http.get('/api/check/auth').success(function(user) {\r\n      $rootScope.user = user\r\n    })\r\n\r\n    $scope.logout = function() {\r\n      $http.get('/api/logout').success(function() {\r\n        $rootScope.user = null\r\n      })\r\n    } \r\n\r\n    $scope.delete = function(posts, post) {\r\n      return _subreddit.delete({\r\n        subreddit: post.subreddit,\r\n        comments: 'comments',\r\n        post: post._id\r\n      }, function() {\r\n        _remove(posts, post)\r\n        if (~$location.path().search('comments')) \r\n          $location.path('/')\r\n      })\r\n    }\r\n\r\n    $scope.vote = function(n, post) {\r\n      if (!$rootScope.user) return false\r\n\r\n      var url = '/api/' + \r\n                (post.comments ? 'posts/' : 'comments/') +\r\n                post._id + '/vote/' + n\r\n\r\n      $http.put(url).success(function() {\r\n        var vote = n > 0 ? 'upvotes' : 'downvotes',\r\n            username = $rootScope.user.username\r\n\r\n        if (~post[vote].indexOf(username))\r\n          _remove(post[vote], username)\r\n        else\r\n          post[vote].push(username)\r\n        \r\n        _remove(post[n < 0 ? 'upvotes' : 'downvotes'], username)\r\n      })\r\n    }\r\n\r\n    $scope.isVoted = function(n, post) {\r\n      if (!$rootScope.user) return false\r\n\r\n      var vote = n > 0 ? 'upvotes' : 'downvotes'\r\n\r\n      return ~post[vote].indexOf($rootScope.user.username)\r\n    }\r\n\r\n    $scope.changePage = function(n) {\r\n      $location.search('page', $scope.page += n)\r\n      $anchorScroll(0)\r\n    }\r\n\r\n    $rootScope.$on('$routeChangeSuccess', function() {\r\n      $rootScope.history.push($location.$$path)\r\n    })\r\n  })\r\n\r\n  .controller('homeCtrl', function($scope, $rootScope, $routeParams, \r\n                          subreddit) {\r\n    $rootScope.subreddit = subreddit\r\n  })\r\n\r\n  .controller('subredditCtrl', function($rootScope, $scope, $routeParams, \r\n                                subreddit) {\r\n    $rootScope.subreddit = subreddit\r\n  })\r\n\r\n  .controller('subredditsCtrl', function($scope, $http) {\r\n    $http\r\n      .get('/api/r')\r\n      .success(function(subreddits) {\r\n        $scope.subreddits = subreddits\r\n      })\r\n  })\r\n\r\n  .controller('newSubredditCtrl', function($scope, $http, $location, \r\n                                  _setDirty) {\r\n    $scope.newSubreddit = {}\r\n\r\n    $scope.submit = function() {\r\n      if ($scope.newSubredditForm.$invalid)\r\n        return _setDirty($scope.newSubredditForm)\r\n\r\n      $http\r\n        .post('/api/r', $scope.newSubreddit)\r\n        .success(function(subreddit) {\r\n          $location.path('/r/' + subreddit.name)\r\n        })\r\n    }\r\n  })\r\n\r\n  .controller('postCtrl', function($rootScope, $scope, $http,\r\n                          subreddit, _subreddit, _setDirty, _remove) {\r\n    $scope.newComment = {}\r\n    $scope.expandText = true\r\n    $rootScope.subreddit = subreddit\r\n\r\n    $scope.addComment = function() {\r\n      if ($scope.newCommentForm.$invalid)\r\n        return _setDirty($scope.newCommentForm)\r\n\r\n      _subreddit.save({\r\n        subreddit: $scope.subreddit.name,\r\n        comments: 'comments',\r\n        post: $scope.subreddit.posts[0]._id\r\n      }, $scope.newComment, function(comment) {\r\n        $scope.subreddit.posts[0].comments.push(comment)\r\n        $scope.newComment = {}\r\n        $scope.newCommentForm.comment.$setPristine()\r\n      })\r\n    }\r\n\r\n    $scope.deleteComment = function(comment) {\r\n      $http\r\n        .delete('/api/comments/' + comment._id)\r\n        .success(function() {\r\n          _remove($scope.subreddit.posts[0].comments, comment)\r\n        })\r\n\r\n      return false\r\n    }\r\n  })\r\n\r\n  .controller('submitCtrl', function($scope, $routeParams, $location, \r\n                            _subreddit, _setDirty) {\r\n    $scope.newPost = {}\r\n    $scope.type = $routeParams.type\r\n    \r\n    if ($scope.subreddit) \r\n      $scope.newPost.subreddit = $scope.subreddit.name\r\n\r\n    $scope.submit = function() {\r\n      if ($scope.newPostForm.$invalid)\r\n        return _setDirty($scope.newPostForm)\r\n\r\n      _subreddit.save({ \r\n        subreddit: $scope.newPost.subreddit \r\n      }, $scope.newPost, function(post) {\r\n        $location.path('/r/' + post.subreddit + '/comments/' + post._id)\r\n      })\r\n    }\r\n  })\r\n\r\n  .controller('signupCtrl', function($rootScope, $scope, $http, $location,\r\n                            _afterLogin, _setDirty) {\r\n    if ($rootScope.user) return $location.path('/')\r\n    $scope.newUser = {}\r\n\r\n    $scope.signup = function() {\r\n      if ($scope.signupForm.$invalid) \r\n        return _setDirty($scope.signupForm)\r\n\r\n      $http\r\n        .post('/api/signup', $scope.newUser)\r\n        .success(_afterLogin)\r\n    }\r\n  })\r\n\r\n  .controller('loginCtrl', function($rootScope, $scope, $http, $location,\r\n                           _afterLogin, _setDirty) {\r\n    if ($rootScope.user) return $location.path('/')\r\n    $scope.loggedUser = {}\r\n\r\n    $scope.login = function() {\r\n      if ($scope.loginForm.$invalid)\r\n        return _setDirty($scope.loginForm)\r\n\r\n      $http\r\n        .post('/api/login', $scope.loggedUser)\r\n        .success(_afterLogin)\r\n    }\r\n  })","angular\r\n  .module('ngReddit')\r\n\r\n  .factory('_subreddit', function($resource) {\r\n    return $resource('/api/r/:subreddit/:comments/:post')\r\n  })\r\n\r\n  .factory('_posts', function($resource) {\r\n    return $resource('/api/posts/')\r\n  })\r\n\r\n  .factory('_authUser', function($resource) {\r\n    return $resource('/api/authcheck')\r\n  })\r\n\r\n  .factory('_remove', function() {\r\n    return function(a, e) {\r\n      var i = a.indexOf(e)\r\n      if (i > -1) return a.splice(i, 1)\r\n    }\r\n  })\r\n\r\n  .factory('_afterLogin', function($http, $rootScope, $location) {\r\n    return function(user) {\r\n      $rootScope.user = user\r\n      $location.path($rootScope.history[$rootScope.history.length-2] || '/')\r\n    }\r\n  })\r\n\r\n  .factory('_setDirty', function() {\r\n    return function(form) {\r\n      for (var k in form) \r\n        if (/^[^$]/.test(k)) form[k].$setDirty()      \r\n    }\r\n  })","angular\r\n  .module('ngReddit')\r\n\r\n  .filter('pluralize', function() {\r\n    // {{post.comments.length + ' комментари(й,я,ев)' | pluralize}}\r\n\r\n    return function(s) {\r\n      var n = '' + parseInt(s),\r\n          last = n.slice(-1)\r\n\r\n      return s.replace(/\\(([^)]+)\\)/, function(m) {\r\n        m = m.slice(1, -1).split(',')\r\n\r\n        if (n.slice(-2, -1) == 1 || last > 4 || last === '0')\r\n          return m[2]\r\n        else if (last == 1)\r\n          return m[0]\r\n        else\r\n          return m[1]\r\n      })\r\n    }\r\n  })\r\n\r\n  .filter('fromNow', function() {\r\n    return function(date) {\r\n      return moment(date).fromNow()\r\n    }\r\n  })\r\n\r\n  .filter('md', function($sce) {\r\n    return function(text) {\r\n      return $sce.trustAsHtml(markdown.toHTML(text || ''))\r\n    }\r\n  })\r\n\r\n  .filter('hostname', function() {\r\n    return function(link) {\r\n      if (!link) return 'self'\r\n      var a = document.createElement('a')\r\n      a.href = link\r\n      return a.hostname\r\n    }\r\n  })"],"sourceRoot":"/source/"}