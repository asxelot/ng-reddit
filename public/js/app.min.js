function inputDirective(){return{restrict:"E",require:"ngModel",link:function(t,e,r,n){n.$options=n.$options||{},angular.extend(n.$options,{allowInvalid:!0,updateOnDefault:!0}),t.$watch(r.ngModel,function(t){e[t?"addClass":"removeClass"]("ng-not-empty")})}}}angular.module("ngReddit",["ngMessages","ngResource","ngRoute"]).config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"views/home.html",controller:"homeCtrl",reloadOnSearch:!0,resolve:{subreddit:["$route","_posts",function(t,e){return e.get({page:t.current.params.page||1}).$promise}]}}).when("/r/:subreddit",{templateUrl:"views/home.html",controller:"subredditCtrl",resolve:{subreddit:["$route","_subreddit",function(t,e){return e.get({subreddit:t.current.params.subreddit,page:t.current.params.page||1}).$promise}]}}).when("/r/:subreddit/comments/:post",{templateUrl:"views/post.html",controller:"postCtrl",resolve:{subreddit:["$route","_subreddit",function(t,e){return e.get({subreddit:t.current.params.subreddit,comments:"comments",post:t.current.params.post}).$promise}]}}).when("/subreddits",{templateUrl:"views/subreddits.html",controller:"subredditsCtrl"}).when("/subreddits/create",{templateUrl:"views/newSubreddit.html",controller:"newSubredditCtrl"}).when("/submit/:type",{templateUrl:"views/submit.html",controller:"submitCtrl"}).when("/search/:query",{templateUrl:"views/_posts.html",controller:"searchCtrl",resolve:{results:["$route","_search",function(t,e){return e.query({query:t.current.params.query})}]}}).when("/signup",{templateUrl:"views/signup.html",controller:"signupCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"loginCtrl"}),e.html5Mode(!0)}]).config(["$httpProvider",function(t){t.interceptors.push(["$q","$rootScope",function(t,e){function r(r){return console.error(r),e.errors.push(r.data),t.reject(r)}return{requestError:r,responseError:r}}])}]),angular.module("ngReddit").controller("mainCtrl",["$rootScope","$scope","$http","$location","$anchorScroll","_subreddit","_vote",function(t,e,r,n,o,i,s){e.page=+n.search().page||1,t.errors=[],t.history=[],e.vote=s,r.get("/api/check/auth").success(function(e){t.user=e}),e.logout=function(){r.get("/api/logout").success(function(){t.user=null})},e["delete"]=function(t,e){return i["delete"]({subreddit:e.subreddit,comments:"comments",post:e._id},function(){_remove(t,e),~n.path().search("comments")&&n.path("/")})},e.isVoted=function(e,r){if(!t.user)return!1;var n=r>0?"upvotes":"downvotes";return~e[n].indexOf(t.user.username)},e.changePage=function(t){n.search("page",e.page+=t),o(0)},e.search=function(){n.path("/search/"+window.encodeURIComponent(e.query)),e.query=""},t.$on("$routeChangeSuccess",function(){t.history.push(n.$$path)})}]).controller("homeCtrl",["$scope","$rootScope","$routeParams","subreddit",function(t,e,r,n){e.subreddit=n}]).controller("subredditCtrl",["$rootScope","$scope","$routeParams","subreddit",function(t,e,r,n){t.subreddit=n}]).controller("subredditsCtrl",["$scope","$http",function(t,e){e.get("/api/r").success(function(e){t.subreddits=e})}]).controller("newSubredditCtrl",["$scope","$http","$location","_setDirty",function(t,e,r,n){t.newSubreddit={},t.submit=function(){return t.newSubredditForm.$invalid?n(t.newSubredditForm):void e.post("/api/r",t.newSubreddit).success(function(t){r.path("/r/"+t.name)})}}]).controller("postCtrl",["$rootScope","$scope","$http","subreddit","_subreddit","_setDirty","_remove",function(t,e,r,n,o,i,s){e.newComment={},e.expandText=!0,t.subreddit=n,e.addComment=function(){return e.newCommentForm.$invalid?i(e.newCommentForm):void o.save({subreddit:e.subreddit.name,comments:"comments",post:e.subreddit.posts[0]._id},e.newComment,function(t){e.subreddit.posts[0].comments.push(t),e.newComment={},e.newCommentForm.comment.$setPristine()})},e.deleteComment=function(t){return r["delete"]("/api/comments/"+t._id).success(function(){s(e.subreddit.posts[0].comments,t)}),!1}}]).controller("submitCtrl",["$scope","$routeParams","$location","_subreddit","_setDirty",function(t,e,r,n,o){t.newPost={},t.type=e.type,t.subreddit&&(t.newPost.subreddit=t.subreddit.name),t.submit=function(){return t.newPostForm.$invalid?o(t.newPostForm):void n.save({subreddit:t.newPost.subreddit},t.newPost,function(t){r.path("/r/"+t.subreddit+"/comments/"+t._id)})}}]).controller("searchCtrl",["$scope","results",function(t,e){t.subreddit={posts:e}}]).controller("signupCtrl",["$rootScope","$scope","$http","$location","_afterLogin","_setDirty",function(t,e,r,n,o,i){return t.user?n.path("/"):(e.newUser={},void(e.signup=function(){return e.signupForm.$invalid?i(e.signupForm):void r.post("/api/signup",e.newUser).success(o)}))}]).controller("loginCtrl",["$rootScope","$scope","$http","$location","_afterLogin","_setDirty",function(t,e,r,n,o,i){return t.user?n.path("/"):(e.loggedUser={},void(e.login=function(){return e.loginForm.$invalid?i(e.loginForm):void r.post("/api/login",e.loggedUser).success(o)}))}]),angular.module("ngReddit").directive("subredditExist",["$q","$http",function(t,e){function r(r){return t(function(t,n){e.get("/api/check/r/"+r).success(function(e){e?t():n()})})}return{restrict:"A",require:"ngModel",link:function(t,e,n,o){o.$asyncValidators.subredditExist=r}}}]).directive("subredditAvailable",["$q","$http",function(t,e){function r(r){return t(function(t,n){e.get("/api/check/r/"+r).success(function(e){e?n():t()})})}return{restrict:"A",require:"ngModel",link:function(t,e,n,o){o.$asyncValidators.subredditAvailable=r}}}]).directive("usernameValidator",["$q","$http",function(t,e){function r(r){return t(function(t,n){e.get("/api/check/u/"+r).success(function(e){e?n():t()})})}function n(t){return/^[a-zA-Z][a-zA-Z0-9]+$/.test(t)}return{restrict:"A",require:"ngModel",link:function(t,e,o,i){i.$asyncValidators.checkUsername=r,i.$validators.invalidUsername=n}}}]).directive("emailExist",["$q","$http",function(t,e){function r(r){return t(function(t,n){e.get("/api/check/email/"+r).success(function(e){e?n():t()})})}return{restrict:"A",require:"ngModel",link:function(t,e,n,o){o.$asyncValidators.emailExist=r}}}]).directive("matchTo",function(){return{restrict:"A",scope:{password:"=matchTo"},require:"ngModel",link:function(t,e,r,n){n.$validators.matchPassword=function(e){return t.password==e},t.$watch("password",n.$validate)}}}).directive("elasticTextarea",function(){return{restrict:"A",link:function(t,e){e.on("input",function(){e[0].style.height=e[0].scrollHeight+"px"})}}}).directive("input",inputDirective).directive("textarea",inputDirective),angular.module("ngReddit").factory("_subreddit",["$resource",function(t){return t("/api/r/:subreddit/:comments/:post")}]).factory("_posts",["$resource",function(t){return t("/api/posts/")}]).factory("_search",["$resource",function(t){return t("/api/search/:query")}]).factory("_authUser",["$resource",function(t){return t("/api/authcheck")}]).factory("_remove",function(){return function(t,e){var r=t.indexOf(e);return r>-1?t.splice(r,1):void 0}}).factory("_vote",["$http","$rootScope","_remove",function(t,e,r){return function(n,o){if(e.user){var i=e.user.username,s=o>0?"upvotes":"downvotes",u="/api/"+(n.comments?"posts/":"comments/")+n._id+"/vote/"+o;t.put(u).success(function(){~n[s].indexOf(i)?r(n[s],i):n[s].push(i),r(n[0>o?"upvotes":"downvotes"],i)})}}}]).factory("_afterLogin",["$http","$rootScope","$location",function(t,e,r){return function(t){e.user=t,r.path(e.history[e.history.length-2]||"/")}}]).factory("_setDirty",function(){return function(t){for(var e in t)/^[^$]/.test(e)&&t[e].$setDirty()}}),angular.module("ngReddit").filter("pluralize",function(){return function(t){var e=""+parseInt(t),r=e.slice(-1);return t.replace(/\(([^)]+)\)/,function(t){return t=t.slice(1,-1).split(","),1==e.slice(-2,-1)||r>4||"0"===r?t[2]:1==r?t[0]:t[1]})}}).filter("fromNow",function(){return function(t){return moment(t).fromNow()}}).filter("md",["$sce",function(t){return function(e){return t.trustAsHtml(markdown.toHTML(e||""))}}]).filter("hostname",function(){return function(t){if(!t)return"self";var e=document.createElement("a");return e.href=t,e.hostname}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMuanMiLCJhcHAuanMiLCJjb250cm9sbGVycy5qcyIsImZhY3Rvcmllcy5qcyIsImZpbHRlcnMuanMiXSwibmFtZXMiOlsiaW5wdXREaXJlY3RpdmUiLCJyZXN0cmljdCIsInJlcXVpcmUiLCJsaW5rIiwic2NvcGUiLCJlbCIsImF0dHJzIiwibmdNb2RlbCIsIiRvcHRpb25zIiwiYW5ndWxhciIsImV4dGVuZCIsImFsbG93SW52YWxpZCIsInVwZGF0ZU9uRGVmYXVsdCIsIiR3YXRjaCIsInZhbCIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicmVsb2FkT25TZWFyY2giLCJyZXNvbHZlIiwic3VicmVkZGl0IiwiJHJvdXRlIiwiX3Bvc3RzIiwiZ2V0IiwicGFnZSIsImN1cnJlbnQiLCJwYXJhbXMiLCIkcHJvbWlzZSIsIl9zdWJyZWRkaXQiLCJjb21tZW50cyIsInBvc3QiLCJyZXN1bHRzIiwiX3NlYXJjaCIsInF1ZXJ5IiwiaHRtbDVNb2RlIiwiJGh0dHBQcm92aWRlciIsImludGVyY2VwdG9ycyIsInB1c2giLCIkcSIsIiRyb290U2NvcGUiLCJvbkVycm9yIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZXJyb3JzIiwiZGF0YSIsInJlamVjdCIsInJlcXVlc3RFcnJvciIsInJlc3BvbnNlRXJyb3IiLCIkc2NvcGUiLCIkaHR0cCIsIiRsb2NhdGlvbiIsIiRhbmNob3JTY3JvbGwiLCJfdm90ZSIsInNlYXJjaCIsImhpc3RvcnkiLCJ2b3RlIiwic3VjY2VzcyIsInVzZXIiLCJsb2dvdXQiLCJwb3N0cyIsIl9pZCIsIl9yZW1vdmUiLCJwYXRoIiwiaXNWb3RlZCIsIm4iLCJpbmRleE9mIiwidXNlcm5hbWUiLCJjaGFuZ2VQYWdlIiwid2luZG93IiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiJG9uIiwiJCRwYXRoIiwiJHJvdXRlUGFyYW1zIiwic3VicmVkZGl0cyIsIl9zZXREaXJ0eSIsIm5ld1N1YnJlZGRpdCIsInN1Ym1pdCIsIm5ld1N1YnJlZGRpdEZvcm0iLCIkaW52YWxpZCIsIm5hbWUiLCJuZXdDb21tZW50IiwiZXhwYW5kVGV4dCIsImFkZENvbW1lbnQiLCJuZXdDb21tZW50Rm9ybSIsInNhdmUiLCJjb21tZW50IiwiJHNldFByaXN0aW5lIiwiZGVsZXRlQ29tbWVudCIsIm5ld1Bvc3QiLCJ0eXBlIiwibmV3UG9zdEZvcm0iLCJfYWZ0ZXJMb2dpbiIsIm5ld1VzZXIiLCJzaWdudXAiLCJzaWdudXBGb3JtIiwibG9nZ2VkVXNlciIsImxvZ2luIiwibG9naW5Gb3JtIiwiZGlyZWN0aXZlIiwic3VicmVkZGl0RXhpc3QiLCJzdWJyIiwiJGFzeW5jVmFsaWRhdG9ycyIsInN1YnJlZGRpdEF2YWlsYWJsZSIsImNoZWNrVXNlcm5hbWUiLCJpbnZhbGlkVXNlcm5hbWUiLCJ0ZXN0IiwiJHZhbGlkYXRvcnMiLCJlbWFpbEV4aXN0IiwiZW1haWwiLCJwYXNzd29yZCIsIm1hdGNoUGFzc3dvcmQiLCJjb25maXJtUGFzc3dvcmQiLCIkdmFsaWRhdGUiLCJvbiIsInN0eWxlIiwiaGVpZ2h0Iiwic2Nyb2xsSGVpZ2h0IiwiZmFjdG9yeSIsIiRyZXNvdXJjZSIsImEiLCJlIiwiaSIsInNwbGljZSIsInVybCIsInB1dCIsImxlbmd0aCIsImZvcm0iLCJrIiwiJHNldERpcnR5IiwiZmlsdGVyIiwicyIsInBhcnNlSW50IiwibGFzdCIsInNsaWNlIiwicmVwbGFjZSIsIm0iLCJzcGxpdCIsImRhdGUiLCJtb21lbnQiLCJmcm9tTm93IiwiJHNjZSIsInRleHQiLCJ0cnVzdEFzSHRtbCIsIm1hcmtkb3duIiwidG9IVE1MIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaHJlZiIsImhvc3RuYW1lIl0sIm1hcHBpbmdzIjoiQUF5SEEsUUFBU0Esa0JBQ1AsT0FDRUMsU0FBVSxJQUNWQyxRQUFTLFVBQ1RDLEtBQU0sU0FBU0MsRUFBT0MsRUFB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U0FBU3BFLEVBQU9YLEVBQVlZLEdBQ2xELE1BQU8sVUFBU08sR0FDZG5CLEVBQVdtQixLQUFPQSxFQUNsQlAsRUFBVVksS0FBS3hCLEVBQVdnQixRQUFRaEIsRUFBV2dCLFFBQVF1RSxPQUFPLElBQU0sU0FJckVSLFFBQVEsWUFBYSxXQUNwQixNQUFPLFVBQVNTLEdBQ2QsSUFBSyxHQUFJQyxLQUFLRCxHQUNSLFFBQVFyQixLQUFLc0IsSUFBSUQsRUFBS0MsR0FBR0MsZUN6RHJDNUgsUUFDR00sT0FBTyxZQUVQdUgsT0FBTyxZQUFhLFdBR25CLE1BQU8sVUFBU0MsR0FDZCxHQUFJbEUsR0FBSSxHQUFLbUUsU0FBU0QsR0FDbEJFLEVBQU9wRSxFQUFFcUUsTUFBTSxHQUVuQixPQUFPSCxHQUFFSSxRQUFRLGNBQWUsU0FBU0MsR0FHdkMsTUFGQUEsR0FBSUEsRUFBRUYsTUFBTSxFQUFHLElBQUlHLE1BQU0sS0FFRixHQUFuQnhFLEVBQUVxRSxNQUFNLEdBQUksS0FBWUQsRUFBTyxHQUFjLE1BQVRBLEVBQy9CRyxFQUFFLEdBQ00sR0FBUkgsRUFDQUcsRUFBRSxHQUVGQSxFQUFFLFFBS2hCTixPQUFPLFVBQVcsV0FDakIsTUFBTyxVQUFTUSxHQUNkLE1BQU9DLFFBQU9ELEdBQU1FLGFBSXZCVixPQUFPLE1BQUEsT0FBTSxTQUFTVyxHQUNyQixNQUFPLFVBQVNDLEdBQ2QsTUFBT0QsR0FBS0UsWUFBWUMsU0FBU0MsT0FBT0gsR0FBUSxTQUluRFosT0FBTyxXQUFZLFdBQ2xCLE1BQU8sVUFBU25JLEdBQ2QsSUFBS0EsRUFBTSxNQUFPLE1BQ2xCLElBQUl5SCxHQUFJMEIsU0FBU0MsY0FBYyxJQUUvQixPQURBM0IsR0FBRTRCLEtBQU9ySixFQUNGeUgsRUFBRTZCIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyXHJcbiAgLm1vZHVsZSgnbmdSZWRkaXQnKVxyXG5cclxuICAuZGlyZWN0aXZlKCdzdWJyZWRkaXRFeGlzdCcsIGZ1bmN0aW9uKCRxLCAkaHR0cCkge1xyXG4gICAgZnVuY3Rpb24gc3VicmVkZGl0RXhpc3QodmFsKSB7XHJcbiAgICAgIHJldHVybiAkcShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAkaHR0cFxyXG4gICAgICAgICAgLmdldCgnL2FwaS9jaGVjay9yLycgKyB2YWwpXHJcbiAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihzdWJyKSB7XHJcbiAgICAgICAgICAgIHN1YnIgPyByZXNvbHZlKCkgOiByZWplY3QoKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzLCBuZ01vZGVsKSB7XHJcbiAgICAgICAgbmdNb2RlbC4kYXN5bmNWYWxpZGF0b3JzLnN1YnJlZGRpdEV4aXN0ID0gc3VicmVkZGl0RXhpc3RcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5kaXJlY3RpdmUoJ3N1YnJlZGRpdEF2YWlsYWJsZScsIGZ1bmN0aW9uKCRxLCAkaHR0cCkge1xyXG4gICAgZnVuY3Rpb24gc3VicmVkZGl0QXZhaWxhYmxlKHZhbCkge1xyXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgJGh0dHBcclxuICAgICAgICAgIC5nZXQoJy9hcGkvY2hlY2svci8nICsgdmFsKVxyXG4gICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oc3Vicikge1xyXG4gICAgICAgICAgICBzdWJyID8gcmVqZWN0KCkgOiByZXNvbHZlKClcclxuICAgICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycywgbmdNb2RlbCkge1xyXG4gICAgICAgIG5nTW9kZWwuJGFzeW5jVmFsaWRhdG9ycy5zdWJyZWRkaXRBdmFpbGFibGUgPSBzdWJyZWRkaXRBdmFpbGFibGVcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5kaXJlY3RpdmUoJ3VzZXJuYW1lVmFsaWRhdG9yJywgZnVuY3Rpb24oJHEsICRodHRwKSB7XHJcbiAgICBmdW5jdGlvbiBjaGVja1VzZXJuYW1lKHZhbCkge1xyXG4gICAgICByZXR1cm4gJHEoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgJGh0dHBcclxuICAgICAgICAgIC5nZXQoJy9hcGkvY2hlY2svdS8nICsgdmFsKVxyXG4gICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAgICAgICB1c2VyID8gcmVqZWN0KCkgOiByZXNvbHZlKClcclxuICAgICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaW52YWxpZFVzZXJuYW1lKHVzZXJuYW1lKSB7XHJcbiAgICAgIHJldHVybiAvXlthLXpBLVpdW2EtekEtWjAtOV0rJC8udGVzdCh1c2VybmFtZSlcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMsIG5nTW9kZWwpIHtcclxuICAgICAgICBuZ01vZGVsLiRhc3luY1ZhbGlkYXRvcnMuY2hlY2tVc2VybmFtZSA9IGNoZWNrVXNlcm5hbWVcclxuICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLmludmFsaWRVc2VybmFtZSA9IGludmFsaWRVc2VybmFtZVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgLmRpcmVjdGl2ZSgnZW1haWxFeGlzdCcsIGZ1bmN0aW9uKCRxLCAkaHR0cCkge1xyXG4gICAgZnVuY3Rpb24gZW1haWxFeGlzdCh2YWwpIHtcclxuICAgICAgcmV0dXJuICRxKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICRodHRwXHJcbiAgICAgICAgICAuZ2V0KCcvYXBpL2NoZWNrL2VtYWlsLycgKyB2YWwpXHJcbiAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihlbWFpbCkge1xyXG4gICAgICAgICAgICBlbWFpbCA/IHJlamVjdCgpIDogcmVzb2x2ZSgpXHJcbiAgICAgICAgICB9KVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsLCBhdHRycywgbmdNb2RlbCkge1xyXG4gICAgICAgIG5nTW9kZWwuJGFzeW5jVmFsaWRhdG9ycy5lbWFpbEV4aXN0ID0gZW1haWxFeGlzdFxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgLmRpcmVjdGl2ZSgnbWF0Y2hUbycsIGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgc2NvcGU6IHtcclxuICAgICAgICBwYXNzd29yZDogJz1tYXRjaFRvJ1xyXG4gICAgICB9LFxyXG4gICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbCwgYXR0cnMsIG5nTW9kZWwpIHtcclxuICAgICAgICBuZ01vZGVsLiR2YWxpZGF0b3JzLm1hdGNoUGFzc3dvcmQgPSBmdW5jdGlvbihjb25maXJtUGFzc3dvcmQpIHtcclxuICAgICAgICAgIHJldHVybiBzY29wZS5wYXNzd29yZCA9PSBjb25maXJtUGFzc3dvcmRcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNjb3BlLiR3YXRjaCgncGFzc3dvcmQnLCBuZ01vZGVsLiR2YWxpZGF0ZSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5kaXJlY3RpdmUoJ2VsYXN0aWNUZXh0YXJlYScsIGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsKSB7XHJcbiAgICAgICAgZWwub24oJ2lucHV0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBlbFswXS5zdHlsZS5oZWlnaHQgPSBlbFswXS5zY3JvbGxIZWlnaHQgKyAncHgnXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5kaXJlY3RpdmUoJ2lucHV0JywgaW5wdXREaXJlY3RpdmUpXHJcblxyXG4gIC5kaXJlY3RpdmUoJ3RleHRhcmVhJywgaW5wdXREaXJlY3RpdmUpXHJcblxyXG5cclxuZnVuY3Rpb24gaW5wdXREaXJlY3RpdmUoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWwsIGF0dHJzLCBuZ01vZGVsKSB7XHJcbiAgICAgIG5nTW9kZWwuJG9wdGlvbnMgPSBuZ01vZGVsLiRvcHRpb25zIHx8IHt9XHJcbiAgICAgIGFuZ3VsYXIuZXh0ZW5kKFxyXG4gICAgICAgIG5nTW9kZWwuJG9wdGlvbnMsIFxyXG4gICAgICAgIHthbGxvd0ludmFsaWQ6IHRydWUsIHVwZGF0ZU9uRGVmYXVsdDogdHJ1ZX1cclxuICAgICAgKVxyXG5cclxuICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLm5nTW9kZWwsIGZ1bmN0aW9uKHZhbCkge1xyXG4gICAgICAgIGVsW3ZhbD8nYWRkQ2xhc3MnOidyZW1vdmVDbGFzcyddKCduZy1ub3QtZW1wdHknKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH0gIFxyXG59IiwiYW5ndWxhci5tb2R1bGUoJ25nUmVkZGl0JywgW1xyXG4gICAgJ25nTWVzc2FnZXMnLFxyXG4gICAgJ25nUmVzb3VyY2UnLFxyXG4gICAgJ25nUm91dGUnXHJcbiAgXSlcclxuXHJcbiAgLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcclxuICAgICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAgIC53aGVuKCcvJywge1xyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvaG9tZS5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAnaG9tZUN0cmwnLFxyXG4gICAgICAgIHJlbG9hZE9uU2VhcmNoOiB0cnVlLCBcclxuICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICBzdWJyZWRkaXQ6IGZ1bmN0aW9uKCRyb3V0ZSwgX3Bvc3RzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfcG9zdHMuZ2V0KHtcclxuICAgICAgICAgICAgICBwYWdlOiAkcm91dGUuY3VycmVudC5wYXJhbXMucGFnZSB8fCAxXHJcbiAgICAgICAgICAgIH0pLiRwcm9taXNlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAud2hlbignL3IvOnN1YnJlZGRpdCcsIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2hvbWUuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ3N1YnJlZGRpdEN0cmwnLFxyXG4gICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgIHN1YnJlZGRpdDogZnVuY3Rpb24oJHJvdXRlLCBfc3VicmVkZGl0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfc3VicmVkZGl0LmdldCh7XHJcbiAgICAgICAgICAgICAgc3VicmVkZGl0OiAkcm91dGUuY3VycmVudC5wYXJhbXMuc3VicmVkZGl0LFxyXG4gICAgICAgICAgICAgIHBhZ2U6ICRyb3V0ZS5jdXJyZW50LnBhcmFtcy5wYWdlIHx8IDFcclxuICAgICAgICAgICAgfSkuJHByb21pc2VcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC53aGVuKCcvci86c3VicmVkZGl0L2NvbW1lbnRzLzpwb3N0Jywge1xyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcG9zdC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAncG9zdEN0cmwnLFxyXG4gICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgIHN1YnJlZGRpdDogZnVuY3Rpb24oJHJvdXRlLCBfc3VicmVkZGl0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfc3VicmVkZGl0LmdldCh7XHJcbiAgICAgICAgICAgICAgc3VicmVkZGl0OiAkcm91dGUuY3VycmVudC5wYXJhbXMuc3VicmVkZGl0LFxyXG4gICAgICAgICAgICAgIGNvbW1lbnRzOiAnY29tbWVudHMnLFxyXG4gICAgICAgICAgICAgIHBvc3Q6ICRyb3V0ZS5jdXJyZW50LnBhcmFtcy5wb3N0XHJcbiAgICAgICAgICAgIH0pLiRwcm9taXNlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAud2hlbignL3N1YnJlZGRpdHMnLCB7XHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9zdWJyZWRkaXRzLmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdzdWJyZWRkaXRzQ3RybCdcclxuICAgICAgfSlcclxuICAgICAgLndoZW4oJy9zdWJyZWRkaXRzL2NyZWF0ZScsIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL25ld1N1YnJlZGRpdC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAnbmV3U3VicmVkZGl0Q3RybCdcclxuICAgICAgfSlcclxuICAgICAgLndoZW4oJy9zdWJtaXQvOnR5cGUnLCB7XHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9zdWJtaXQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ3N1Ym1pdEN0cmwnXHJcbiAgICAgIH0pXHJcbiAgICAgIC53aGVuKCcvc2VhcmNoLzpxdWVyeScsIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL19wb3N0cy5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAnc2VhcmNoQ3RybCcsXHJcbiAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgcmVzdWx0czogZnVuY3Rpb24oJHJvdXRlLCBfc2VhcmNoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfc2VhcmNoLnF1ZXJ5KHtcclxuICAgICAgICAgICAgICBxdWVyeTogJHJvdXRlLmN1cnJlbnQucGFyYW1zLnF1ZXJ5XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSAgICAgIFxyXG4gICAgICAud2hlbignL3NpZ251cCcsIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3NpZ251cC5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAnc2lnbnVwQ3RybCdcclxuICAgICAgfSlcclxuICAgICAgLndoZW4oJy9sb2dpbicsIHtcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2xvZ2luLmh0bWwnLFxyXG4gICAgICAgIGNvbnRyb2xsZXI6ICdsb2dpbkN0cmwnXHJcbiAgICAgIH0pXHJcblxyXG5cclxuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKVxyXG4gIH0pXHJcblxyXG4gIC5jb25maWcoZnVuY3Rpb24oJGh0dHBQcm92aWRlcikge1xyXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaChmdW5jdGlvbigkcSwgJHJvb3RTY29wZSkge1xyXG4gICAgICBmdW5jdGlvbiBvbkVycm9yKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKVxyXG4gICAgICAgICRyb290U2NvcGUuZXJyb3JzLnB1c2goZXJyLmRhdGEpXHJcbiAgICAgICAgcmV0dXJuICRxLnJlamVjdChlcnIpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVxdWVzdEVycm9yOiBvbkVycm9yLFxyXG4gICAgICAgIHJlc3BvbnNlRXJyb3I6IG9uRXJyb3JcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9KSIsImFuZ3VsYXJcclxuICAubW9kdWxlKCduZ1JlZGRpdCcpXHJcblxyXG4gIC5jb250cm9sbGVyKCdtYWluQ3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGh0dHAsICRsb2NhdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAkYW5jaG9yU2Nyb2xsLCBfc3VicmVkZGl0LCBfdm90ZSkge1xyXG4gICAgJHNjb3BlLnBhZ2UgPSArJGxvY2F0aW9uLnNlYXJjaCgpLnBhZ2UgfHwgMVxyXG4gICAgJHJvb3RTY29wZS5lcnJvcnMgPSBbXVxyXG4gICAgJHJvb3RTY29wZS5oaXN0b3J5ID0gW11cclxuICAgICRzY29wZS52b3RlID0gX3ZvdGVcclxuXHJcbiAgICAkaHR0cC5nZXQoJy9hcGkvY2hlY2svYXV0aCcpLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xyXG4gICAgICAkcm9vdFNjb3BlLnVzZXIgPSB1c2VyXHJcbiAgICB9KVxyXG5cclxuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgJGh0dHAuZ2V0KCcvYXBpL2xvZ291dCcpLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0gbnVsbFxyXG4gICAgICB9KVxyXG4gICAgfSBcclxuXHJcbiAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24ocG9zdHMsIHBvc3QpIHsgXHJcbiAgICAgIHJldHVybiBfc3VicmVkZGl0LmRlbGV0ZSh7XHJcbiAgICAgICAgc3VicmVkZGl0OiBwb3N0LnN1YnJlZGRpdCxcclxuICAgICAgICBjb21tZW50czogJ2NvbW1lbnRzJyxcclxuICAgICAgICBwb3N0OiBwb3N0Ll9pZFxyXG4gICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICBfcmVtb3ZlKHBvc3RzLCBwb3N0KVxyXG4gICAgICAgIGlmICh+JGxvY2F0aW9uLnBhdGgoKS5zZWFyY2goJ2NvbW1lbnRzJykpIFxyXG4gICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5pc1ZvdGVkID0gZnVuY3Rpb24ocG9zdCwgbikge1xyXG4gICAgICBpZiAoISRyb290U2NvcGUudXNlcikgcmV0dXJuIGZhbHNlICBcclxuXHJcbiAgICAgIHZhciB2b3RlID0gbiA+IDAgPyAndXB2b3RlcycgOiAnZG93bnZvdGVzJyBcclxuXHJcbiAgICAgIHJldHVybiB+cG9zdFt2b3RlXS5pbmRleE9mKCRyb290U2NvcGUudXNlci51c2VybmFtZSlcclxuICAgIH0gXHJcblxyXG4gICAgJHNjb3BlLmNoYW5nZVBhZ2UgPSBmdW5jdGlvbihuKSB7IFxyXG4gICAgICAkbG9jYXRpb24uc2VhcmNoKCdwYWdlJywgJHNjb3BlLnBhZ2UgKz0gbilcclxuICAgICAgJGFuY2hvclNjcm9sbCgwKVxyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5zZWFyY2ggPSBmdW5jdGlvbigpIHsgICAgIFxyXG4gICAgICAkbG9jYXRpb24ucGF0aCgnL3NlYXJjaC8nICsgd2luZG93LmVuY29kZVVSSUNvbXBvbmVudCgkc2NvcGUucXVlcnkpKVxyXG4gICAgICAkc2NvcGUucXVlcnkgPSAnJ1xyXG4gICAgfVxyXG5cclxuICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICRyb290U2NvcGUuaGlzdG9yeS5wdXNoKCRsb2NhdGlvbi4kJHBhdGgpXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIC5jb250cm9sbGVyKCdob21lQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJyZWRkaXQpIHtcclxuICAgICRyb290U2NvcGUuc3VicmVkZGl0ID0gc3VicmVkZGl0XHJcbiAgfSlcclxuXHJcbiAgLmNvbnRyb2xsZXIoJ3N1YnJlZGRpdEN0cmwnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VicmVkZGl0KSB7XHJcbiAgICAkcm9vdFNjb3BlLnN1YnJlZGRpdCA9IHN1YnJlZGRpdFxyXG4gIH0pXHJcblxyXG4gIC5jb250cm9sbGVyKCdzdWJyZWRkaXRzQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcclxuICAgICRodHRwXHJcbiAgICAgIC5nZXQoJy9hcGkvcicpXHJcbiAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHN1YnJlZGRpdHMpIHtcclxuICAgICAgICAkc2NvcGUuc3VicmVkZGl0cyA9IHN1YnJlZGRpdHNcclxuICAgICAgfSlcclxuICB9KVxyXG5cclxuICAuY29udHJvbGxlcignbmV3U3VicmVkZGl0Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfc2V0RGlydHkpIHtcclxuICAgICRzY29wZS5uZXdTdWJyZWRkaXQgPSB7fVxyXG5cclxuICAgICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgaWYgKCRzY29wZS5uZXdTdWJyZWRkaXRGb3JtLiRpbnZhbGlkKVxyXG4gICAgICAgIHJldHVybiBfc2V0RGlydHkoJHNjb3BlLm5ld1N1YnJlZGRpdEZvcm0pXHJcblxyXG4gICAgICAkaHR0cFxyXG4gICAgICAgIC5wb3N0KCcvYXBpL3InLCAkc2NvcGUubmV3U3VicmVkZGl0KVxyXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKHN1YnJlZGRpdCkge1xyXG4gICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yLycgKyBzdWJyZWRkaXQubmFtZSlcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5jb250cm9sbGVyKCdwb3N0Q3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGh0dHAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3VicmVkZGl0LCBfc3VicmVkZGl0LCBfc2V0RGlydHksIF9yZW1vdmUpIHtcclxuICAgICRzY29wZS5uZXdDb21tZW50ID0ge31cclxuICAgICRzY29wZS5leHBhbmRUZXh0ID0gdHJ1ZVxyXG4gICAgJHJvb3RTY29wZS5zdWJyZWRkaXQgPSBzdWJyZWRkaXRcclxuXHJcbiAgICAkc2NvcGUuYWRkQ29tbWVudCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBpZiAoJHNjb3BlLm5ld0NvbW1lbnRGb3JtLiRpbnZhbGlkKVxyXG4gICAgICAgIHJldHVybiBfc2V0RGlydHkoJHNjb3BlLm5ld0NvbW1lbnRGb3JtKVxyXG5cclxuICAgICAgX3N1YnJlZGRpdC5zYXZlKHtcclxuICAgICAgICBzdWJyZWRkaXQ6ICRzY29wZS5zdWJyZWRkaXQubmFtZSxcclxuICAgICAgICBjb21tZW50czogJ2NvbW1lbnRzJyxcclxuICAgICAgICBwb3N0OiAkc2NvcGUuc3VicmVkZGl0LnBvc3RzWzBdLl9pZFxyXG4gICAgICB9LCAkc2NvcGUubmV3Q29tbWVudCwgZnVuY3Rpb24oY29tbWVudCkge1xyXG4gICAgICAgICRzY29wZS5zdWJyZWRkaXQucG9zdHNbMF0uY29tbWVudHMucHVzaChjb21tZW50KVxyXG4gICAgICAgICRzY29wZS5uZXdDb21tZW50ID0ge31cclxuICAgICAgICAkc2NvcGUubmV3Q29tbWVudEZvcm0uY29tbWVudC4kc2V0UHJpc3RpbmUoKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5kZWxldGVDb21tZW50ID0gZnVuY3Rpb24oY29tbWVudCkge1xyXG4gICAgICAkaHR0cFxyXG4gICAgICAgIC5kZWxldGUoJy9hcGkvY29tbWVudHMvJyArIGNvbW1lbnQuX2lkKVxyXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgX3JlbW92ZSgkc2NvcGUuc3VicmVkZGl0LnBvc3RzWzBdLmNvbW1lbnRzLCBjb21tZW50KVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICB9KVxyXG5cclxuICAuY29udHJvbGxlcignc3VibWl0Q3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3N1YnJlZGRpdCwgX3NldERpcnR5KSB7XHJcbiAgICAkc2NvcGUubmV3UG9zdCA9IHt9XHJcbiAgICAkc2NvcGUudHlwZSA9ICRyb3V0ZVBhcmFtcy50eXBlXHJcbiAgICBcclxuICAgIGlmICgkc2NvcGUuc3VicmVkZGl0KSBcclxuICAgICAgJHNjb3BlLm5ld1Bvc3Quc3VicmVkZGl0ID0gJHNjb3BlLnN1YnJlZGRpdC5uYW1lXHJcblxyXG4gICAgJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBpZiAoJHNjb3BlLm5ld1Bvc3RGb3JtLiRpbnZhbGlkKVxyXG4gICAgICAgIHJldHVybiBfc2V0RGlydHkoJHNjb3BlLm5ld1Bvc3RGb3JtKVxyXG5cclxuICAgICAgX3N1YnJlZGRpdC5zYXZlKHsgXHJcbiAgICAgICAgc3VicmVkZGl0OiAkc2NvcGUubmV3UG9zdC5zdWJyZWRkaXQgXHJcbiAgICAgIH0sICRzY29wZS5uZXdQb3N0LCBmdW5jdGlvbihwb3N0KSB7XHJcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9yLycgKyBwb3N0LnN1YnJlZGRpdCArICcvY29tbWVudHMvJyArIHBvc3QuX2lkKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5jb250cm9sbGVyKCdzZWFyY2hDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCByZXN1bHRzKSB7XHJcbiAgICAkc2NvcGUuc3VicmVkZGl0ID0ge1xyXG4gICAgICBwb3N0czogcmVzdWx0c1xyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5jb250cm9sbGVyKCdzaWdudXBDdHJsJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX2FmdGVyTG9naW4sIF9zZXREaXJ0eSkge1xyXG4gICAgaWYgKCRyb290U2NvcGUudXNlcikgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCcvJylcclxuICAgICRzY29wZS5uZXdVc2VyID0ge31cclxuXHJcbiAgICAkc2NvcGUuc2lnbnVwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIGlmICgkc2NvcGUuc2lnbnVwRm9ybS4kaW52YWxpZCkgXHJcbiAgICAgICAgcmV0dXJuIF9zZXREaXJ0eSgkc2NvcGUuc2lnbnVwRm9ybSlcclxuXHJcbiAgICAgICRodHRwXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvc2lnbnVwJywgJHNjb3BlLm5ld1VzZXIpXHJcbiAgICAgICAgLnN1Y2Nlc3MoX2FmdGVyTG9naW4pXHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgLmNvbnRyb2xsZXIoJ2xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgJGh0dHAsICRsb2NhdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgX2FmdGVyTG9naW4sIF9zZXREaXJ0eSkge1xyXG4gICAgaWYgKCRyb290U2NvcGUudXNlcikgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCcvJylcclxuICAgICRzY29wZS5sb2dnZWRVc2VyID0ge31cclxuXHJcbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgaWYgKCRzY29wZS5sb2dpbkZvcm0uJGludmFsaWQpXHJcbiAgICAgICAgcmV0dXJuIF9zZXREaXJ0eSgkc2NvcGUubG9naW5Gb3JtKVxyXG5cclxuICAgICAgJGh0dHBcclxuICAgICAgICAucG9zdCgnL2FwaS9sb2dpbicsICRzY29wZS5sb2dnZWRVc2VyKVxyXG4gICAgICAgIC5zdWNjZXNzKF9hZnRlckxvZ2luKVxyXG4gICAgfVxyXG4gIH0pIiwiYW5ndWxhclxyXG4gIC5tb2R1bGUoJ25nUmVkZGl0JylcclxuXHJcbiAgLmZhY3RvcnkoJ19zdWJyZWRkaXQnLCBmdW5jdGlvbigkcmVzb3VyY2UpIHtcclxuICAgIHJldHVybiAkcmVzb3VyY2UoJy9hcGkvci86c3VicmVkZGl0Lzpjb21tZW50cy86cG9zdCcpXHJcbiAgfSlcclxuXHJcbiAgLmZhY3RvcnkoJ19wb3N0cycsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xyXG4gICAgcmV0dXJuICRyZXNvdXJjZSgnL2FwaS9wb3N0cy8nKVxyXG4gIH0pXHJcblxyXG4gIC5mYWN0b3J5KCdfc2VhcmNoJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XHJcbiAgICByZXR1cm4gJHJlc291cmNlKCcvYXBpL3NlYXJjaC86cXVlcnknKVxyXG4gIH0pXHJcblxyXG4gIC5mYWN0b3J5KCdfYXV0aFVzZXInLCBmdW5jdGlvbigkcmVzb3VyY2UpIHtcclxuICAgIHJldHVybiAkcmVzb3VyY2UoJy9hcGkvYXV0aGNoZWNrJylcclxuICB9KVxyXG5cclxuICAuZmFjdG9yeSgnX3JlbW92ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKGEsIGUpIHtcclxuICAgICAgdmFyIGkgPSBhLmluZGV4T2YoZSlcclxuICAgICAgaWYgKGkgPiAtMSkgcmV0dXJuIGEuc3BsaWNlKGksIDEpXHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgLmZhY3RvcnkoJ192b3RlJywgZnVuY3Rpb24oJGh0dHAsICRyb290U2NvcGUsIF9yZW1vdmUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbihwb3N0LCBuKSB7XHJcbiAgICAgIGlmICghJHJvb3RTY29wZS51c2VyKSByZXR1cm5cclxuICAgICAgICBcclxuICAgICAgdmFyIHVzZXJuYW1lID0gJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lLFxyXG4gICAgICAgICAgdm90ZSA9IG4gPiAwID8gJ3Vwdm90ZXMnIDogJ2Rvd252b3RlcycsXHJcbiAgICAgICAgICB1cmwgPSAnL2FwaS8nICsgXHJcbiAgICAgICAgICAgICAgICAocG9zdC5jb21tZW50cyA/ICdwb3N0cy8nIDogJ2NvbW1lbnRzLycpICsgXHJcbiAgICAgICAgICAgICAgICBwb3N0Ll9pZCArICcvdm90ZS8nICsgblxyXG5cclxuICAgICAgJGh0dHAucHV0KHVybCkuc3VjY2VzcyhmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAofnBvc3Rbdm90ZV0uaW5kZXhPZih1c2VybmFtZSkpXHJcbiAgICAgICAgICBfcmVtb3ZlKHBvc3Rbdm90ZV0sIHVzZXJuYW1lKVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgIHBvc3Rbdm90ZV0ucHVzaCh1c2VybmFtZSlcclxuICAgICAgICBcclxuICAgICAgICBfcmVtb3ZlKHBvc3RbbiA8IDAgPyAndXB2b3RlcycgOiAnZG93bnZvdGVzJ10sIHVzZXJuYW1lKVxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5mYWN0b3J5KCdfYWZ0ZXJMb2dpbicsIGZ1bmN0aW9uKCRodHRwLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHtcclxuICAgIHJldHVybiBmdW5jdGlvbih1c2VyKSB7XHJcbiAgICAgICRyb290U2NvcGUudXNlciA9IHVzZXJcclxuICAgICAgJGxvY2F0aW9uLnBhdGgoJHJvb3RTY29wZS5oaXN0b3J5WyRyb290U2NvcGUuaGlzdG9yeS5sZW5ndGgtMl0gfHwgJy8nKVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC5mYWN0b3J5KCdfc2V0RGlydHknLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbihmb3JtKSB7XHJcbiAgICAgIGZvciAodmFyIGsgaW4gZm9ybSkgXHJcbiAgICAgICAgaWYgKC9eW14kXS8udGVzdChrKSkgZm9ybVtrXS4kc2V0RGlydHkoKSAgICAgIFxyXG4gICAgfVxyXG4gIH0pIiwiYW5ndWxhclxyXG4gIC5tb2R1bGUoJ25nUmVkZGl0JylcclxuXHJcbiAgLmZpbHRlcigncGx1cmFsaXplJywgZnVuY3Rpb24oKSB7XHJcbiAgICAvLyB7e3Bvc3QuY29tbWVudHMubGVuZ3RoICsgJyDQutC+0LzQvNC10L3RgtCw0YDQuCjQuSzRjyzQtdCyKScgfCBwbHVyYWxpemV9fVxyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbihzKSB7XHJcbiAgICAgIHZhciBuID0gJycgKyBwYXJzZUludChzKSxcclxuICAgICAgICAgIGxhc3QgPSBuLnNsaWNlKC0xKVxyXG5cclxuICAgICAgcmV0dXJuIHMucmVwbGFjZSgvXFwoKFteKV0rKVxcKS8sIGZ1bmN0aW9uKG0pIHtcclxuICAgICAgICBtID0gbS5zbGljZSgxLCAtMSkuc3BsaXQoJywnKVxyXG5cclxuICAgICAgICBpZiAobi5zbGljZSgtMiwgLTEpID09IDEgfHwgbGFzdCA+IDQgfHwgbGFzdCA9PT0gJzAnKVxyXG4gICAgICAgICAgcmV0dXJuIG1bMl1cclxuICAgICAgICBlbHNlIGlmIChsYXN0ID09IDEpXHJcbiAgICAgICAgICByZXR1cm4gbVswXVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgIHJldHVybiBtWzFdXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgLmZpbHRlcignZnJvbU5vdycsIGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKGRhdGUpIHtcclxuICAgICAgcmV0dXJuIG1vbWVudChkYXRlKS5mcm9tTm93KClcclxuICAgIH1cclxuICB9KVxyXG5cclxuICAuZmlsdGVyKCdtZCcsIGZ1bmN0aW9uKCRzY2UpIHsgXHJcbiAgICByZXR1cm4gZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbChtYXJrZG93bi50b0hUTUwodGV4dCB8fCAnJykpXHJcbiAgICB9XHJcbiAgfSlcclxuXHJcbiAgLmZpbHRlcignaG9zdG5hbWUnLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbihsaW5rKSB7XHJcbiAgICAgIGlmICghbGluaykgcmV0dXJuICdzZWxmJ1xyXG4gICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKVxyXG4gICAgICBhLmhyZWYgPSBsaW5rXHJcbiAgICAgIHJldHVybiBhLmhvc3RuYW1lXHJcbiAgICB9XHJcbiAgfSkiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
