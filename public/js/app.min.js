angular.module("ngReddit",["ngResource","ngRoute"]).config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"views/home.html",controller:"homeCtrl",resolve:{posts:["_posts",function(t){return t.query()}]}}).when("/r/:subreddit",{templateUrl:"views/subreddit.html",controller:"subredditCtrl",resolve:{subreddit:["$route","_subreddit",function(t,e){return e.get({subreddit:t.current.params.subreddit})}]}}).when("/r/:subreddit/comments/:post",{templateUrl:"views/post.html",controller:"postCtrl",resolve:{subreddit:["$route","_subreddit",function(t,e){return e.get({subreddit:t.current.params.subreddit,comments:"comments",post:t.current.params.post})}]}}).when("/submit/:type",{templateUrl:"views/submit.html",controller:"submitCtrl"}).when("/signup",{templateUrl:"views/signup.html",controller:"signupCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"loginCtrl"}),e.html5Mode(!0)}]).config(["$httpProvider",function(t){t.interceptors.push(["$q","$rootScope",function(t,e){function r(r){return console.error(r),e.errors.push(r.data),t.reject(r)}return{requestError:r,responseError:r}}])}]),angular.module("ngReddit").controller("mainCtrl",["$rootScope","$scope","$http","$location","_subreddit","_remove",function(t,e,r,o,n,s){t.errors=[],t.history=[],r.get("/api/authcheck").success(function(e){t.user=e}),e.logout=function(){r.get("/api/logout").success(function(){t.user=null})},e["delete"]=function(t){return n["delete"]({subreddit:t.subreddit,comments:"comments",post:t._id},function(){s(posts,t)})},t.$on("$routeChangeSuccess",function(e,r,n){t.history.push(o.$$path)})}]).controller("homeCtrl",["$scope","$http","_posts","_remove","_vote","posts",function(t,e,r,o,n,s){t.newPost={},t.posts=s}]).controller("subredditCtrl",["$scope","subreddit",function(t,e){t.subreddit=e,e.$promise.then(function(e){t.posts=e.posts})}]).controller("postCtrl",["$scope","subreddit",function(t,e){t.subreddit=e,e.$promise.then(function(e){t.posts=e.posts})}]).controller("submitCtrl",["$scope","$routeParams",function(t,e){t.type=e.type}]).controller("signupCtrl",["$rootScope","$scope","$http","_afterLogin",function(t,e,r,o){return t.user?$location.path("/"):(e.newUser={},void(e.signup=function(){return e.newUser.password!==e.newUser.confirmPassword?!1:void r.post("/api/signup",e.newUser).success(o)}))}]).controller("loginCtrl",["$rootScope","$scope","$http","_afterLogin",function(t,e,r,o){return t.user?$location.path("/"):(e.loggedUser={},void(e.login=function(){r.post("/api/login",e.loggedUser).success(o)}))}]),angular.module("ngReddit").directive("subredditValidator",["$q","$http",function(t,e){function r(r){return t(function(t,o){e.get("/api/check/r/"+r).success(function(e){e?t():o()})})}return{restrict:"A",require:"ngModel",link:function(t,e,o,n){n.$asyncValidators.checkSubreddit=r}}}]).directive("usernameValidator",["$q","$http",function(t,e){function r(r){return t(function(t,o){e.get("/api/check/u/"+r).success(function(e){e?o():t()})})}return{restrict:"A",require:"ngModel",link:function(t,e,o,n){n.$asyncValidators.checkUsername=r}}}]).directive("emailValidator",["$q","$http",function(t,e){function r(r){return t(function(t,o){e.get("/api/check/email/"+r).success(function(e){e?o():t()})})}return{restrict:"A",require:"ngModel",link:function(t,e,o,n){n.$asyncValidators.checkEmail=r}}}]),angular.module("ngReddit").factory("_subreddit",["$resource",function(t){return t("/api/r/:subreddit/:comments/:post")}]).factory("_posts",["$resource",function(t){return t("/api/posts/")}]).factory("_authUser",["$resource",function(t){return t("/api/authcheck")}]).factory("_remove",function(){return function(t,e){var r=t.indexOf(e);return r>-1?t.splice(r,1):void 0}}).factory("_afterLogin",["$http","$rootScope","$location",function(t,e,r){return function(t){e.user=t,r.path(e.history[e.history.length-2]||"/")}}]).factory("_vote",["$http","$rootScope","_remove",function(t,e,r){return function(o,n,s){t.put(s).success(function(){if(e.user){var t=o>0?"upvoted":"downvoted",s=e.user.username;~n[t].indexOf(s)?r(n[t],s):n[t].push(s),r(n[0>o?"upvoted":"downvoted"],s)}})}}]),angular.module("ngReddit").filter("pluralize",function(){return function(t){var e=""+parseInt(t),r=e.slice(-1);return t.replace(/\(([^)]+)\)/,function(t){return t=t.slice(1,-1).split(","),1==e.slice(-2,-1)||r>4||"0"===r?t[2]:1==r?t[0]:t[1]})}});